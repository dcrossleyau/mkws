<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>MKWS demo: CMS popup plugin with jasmine test framework</title>
    <!-- test like a CMS, with jquery modifications -->

    <script type="text/javascript" src="//code.jquery.com/jquery-1.10.0.min.js"></script>
    <script>
      // create a function in external jquery object
      $.extend({
	mkws_external_jquery_object: function () { return true; }
      });
    </script>

    <script type="text/javascript" src="//mkws.indexdata.com/mkws-complete.js"></script>
    <script>var _jquery = jQuery; $ = jQuery = mkws.$; </script>
    <script type="text/javascript" src="//code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
    <script>jQuery = $ = _jquery; </script>

    <link rel="stylesheet" type="text/css" href="//mkws.indexdata.com/mkws.css" />
    <link rel="stylesheet" type="text/css" href="//code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />

    <link rel="shortcut icon" type="image/png" href="jasmine/lib/jasmine-1.3.1/jasmine_favicon.png">
    <link rel="stylesheet" type="text/css" href="jasmine/lib/jasmine-1.3.1/jasmine.css">

    <script type="text/javascript" src="jasmine/lib/jasmine-1.3.1/jasmine.js"></script>
    <script type="text/javascript" src="jasmine/lib/jasmine-1.3.1/jasmine-html.js"></script>

    <script type="text/javascript" src="test/spec/true.spec.js"></script>
    <script type="text/javascript" src="test/spec/mkws-config.js"></script>
    <script type="text/javascript" src="test/spec/mkws-pazpar2.js"></script>

    <script type="text/javascript" src="test/js/mkws-jasmine-run.js"></script>

    <style type="text/css">
      body > div > form > input.ui-state-default { background: none; }
    </style>
  </head>

  <body>
    <script>
      // jquery.js from <head> section
      if (!($.mkws_external_jquery_object && $.mkws_external_jquery_object())) {
	alert("External jquery(1) mis-match!!!");
      }
      if (mkws.$.mkws_external_jquery_object && mkws.$.mkws_external_jquery_object()) {
	alert("Internal jquery(1) mis-match!!!");
      }
    </script>

    <script type="text/javascript">
    var mkws_config = {
      service_proxy_auth: "//sp-mkws.indexdata.com/service-proxy/?command=auth&action=login&username=mkwstest&password=mkwstest",
      perpage_default: 10
    };

    var jasmine_config = {
      search_query: "freebsd",
      expected_hits: 20,
      check_motd: false,
      show_record_url: true
    };
    </script>

    <h2>MKWS Jasmine regression tests</h2>

    <div class="mkws-search"></div>
    <div class="mkws-popup" popup_width="990" popup_height="760" popup_modal="0" popup_autoOpen="0" popup_button="input.mkws-button">
      <div class="mkws-switch"></div>
      <div class="mkws-lang"></div>
      <div class="mkws-progress"></div>
      <div class="mkws-results"></div>
      <div class="mkws-targets"></div>
      <div class="mkws-stat"></div>
      <div class="mkws-builder"></div>
    </div>

      <!-- include jquery again -->
      <script type="text/javascript" src="//code.jquery.com/jquery-1.10.0.js"></script>
      <script>
	$(document).ready(function() {
	  // now the second jquery is used
	  if ($.mkws_external_jquery_object && $.mkws_external_jquery_object()) {
	    alert("External jquery(2) mis-match!!!");
	  }
	  if (mkws.$.mkws_external_jquery_object && mkws.$.mkws_external_jquery_object()) {
	    alert("Internal jquery(2) mis-match!!!");
	  }

	  // jquery null test
	  $ = undefined;
	  jQuery = undefined;

	  if (!mkws.$) {
	    alert("MKWS jquery(3) is not set!!!");
	  }

	});
      </script>
  </body>
</html>
