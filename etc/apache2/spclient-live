# Configuration for the apache web server
# Running on caliban


<VirtualHost *:80>
    ServerName somesite.indexdata.com
    DocumentRoot /home/indexdata/mkws/experiments/spclient/
    ErrorLog /var/log/apache2/somesite-error.log
    CustomLog /var/log/apache2/somesite-access.log combined
</VirtualHost>


<VirtualHost *:80>
    ServerName mkws.indexdata.com

    ErrorLog /var/log/apache2/mkws-error.log
    CustomLog /var/log/apache2/mkws-access.log combined

    DocumentRoot /home/indexdata/mkws/experiments/spclient/
    Alias /libjs-pz2/ /home/indexdata/libjs-pz2/
    Alias /index.html /home/indexdata/mkws/experiments/spclient/index-mkws.html

    RewriteEngine on
    RewriteLogLevel 1
    RewriteLog /var/log/apache2/mkws-rewrite.log 
    RewriteRule /service-proxy-auth /service-proxy/?command=auth&action=login&username=demo&password=demo [P] # [NE,P]

    Header set Access-Control-Allow-Origin "http://somesite.indexdata.com"
    Header set Access-Control-Allow-Credentials true

    # For MKC Service Proxy
    ProxyPass        /service-proxy/ http://mk2-test.indexdata.com/service-proxy/
    ProxyPassReverse /service-proxy/ http://mk2-test.indexdata.com/service-proxy/

    # Although what follows works perfectly well, it's no use to us:
    # IE8/9 are unable to set or read ANY headers when operating in
    # CORS mode.
    #
    #    PerlOptions +Parent
    #    PerlSwitches -I/home/indexdata/mkws/etc/mod_perl
    #    <Location /service-proxy/>
    #        PerlInputFilterHandler MyApache2::CopyCookie
    #        PerlOutputFilterHandler MyApache2::CopyCookie
    #    </Location>
</VirtualHost>
